{% extends 'base.html' %}
{% block title %}Dashboard | PropVista{% endblock %}
{% block content %}
<div class="page-header">
    <div class="container">
        <h2 class="fw-700 text-white">Welcome, <span class="text-warning">{{ user.first_name|default:user.username
                }}</span></h2>
        <p class="text-white-50 mb-0">Manage your listings and inquiries</p>
    </div>
</div>

<div class="container py-5">

    <!-- Quick Actions -->
    <div class="row g-3 mb-5">
        <div class="col-md-4">
            <a href="/post-listing/" class="action-card text-decoration-none">
                <div class="action-icon bg-warning"><i class="fas fa-plus text-dark"></i></div>
                <div>
                    <div class="fw-700 text-white">Post Property</div>
                    <div class="small text-muted">Submit a new listing</div>
                </div>
            </a>
        </div>
        <div class="col-md-4">
            <a href="/listings/" class="action-card text-decoration-none">
                <div class="action-icon" style="background:#6c63ff"><i class="fas fa-search text-white"></i></div>
                <div>
                    <div class="fw-700 text-white">Browse Listings</div>
                    <div class="small text-muted">{{ my_listings|length }} property listings live</div>
                </div>
            </a>
        </div>
        <div class="col-md-4">
            <a href="/search/" class="action-card text-decoration-none">
                <div class="action-icon" style="background:#20c997"><i class="fas fa-map-marker-alt text-white"></i>
                </div>
                <div>
                    <div class="fw-700 text-white">Search</div>
                    <div class="small text-muted">Find your dream property</div>
                </div>
            </a>
        </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="dashTabs">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#my-listings-tab">
                <i class="fas fa-home me-2"></i>My Listings
                <span class="badge bg-warning text-dark ms-1">{{ my_listings|length }}</span>
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#inquiries-tab">
                <i class="fas fa-envelope me-2"></i>My Inquiries
                <span class="badge bg-secondary ms-1">{{ contacts|length }}</span>
            </button>
        </li>
    </ul>

    <div class="tab-content">

        <!-- My Listings -->
        <div class="tab-pane fade show active" id="my-listings-tab">
            {% if my_listings %}
            <div class="row g-4">
                {% for l in my_listings %}
                <div class="col-md-6 col-lg-4">
                    <div class="prop-card h-100">
                        {% if l.photo_main %}
                        <img src="{{ l.photo_main.url }}" class="prop-card-img" alt="{{ l.title }}">
                        {% else %}
                        <div class="prop-card-img-placeholder"><i class="fas fa-home"></i></div>
                        {% endif %}
                        <div class="p-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span
                                    class="badge {% if l.listing_type == 'rent' %}badge-rent{% else %}badge-sale{% endif %}">
                                    {{ l.listing_type|upper }}
                                </span>
                                <span
                                    class="badge {% if l.is_published %}bg-success{% else %}bg-warning text-dark{% endif %}">
                                    {% if l.is_published %}✓ Live{% else %}⏳ Pending{% endif %}
                                </span>
                            </div>
                            <h6 class="fw-700 text-white mb-1">{{ l.title }}</h6>
                            <p class="text-muted small mb-2"><i class="fas fa-map-marker-alt me-1"></i>{{ l.city }}, {{
                                l.state }}</p>
                            <div class="fw-700 text-warning">{{ l.price_inr }}{% if l.listing_type == 'rent' %}/mo{%
                                endif %}</div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-home fa-3x mb-3 text-muted"></i>
                <h5 class="text-white">No listings yet</h5>
                <p class="text-muted">Post your first property and reach thousands of buyers and renters.</p>
                <a href="/post-listing/" class="btn btn-warning btn-sm fw-700">
                    <i class="fas fa-plus me-1"></i>Post Property
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Inquiries -->
        <div class="tab-pane fade" id="inquiries-tab">
            {% if contacts %}
            <div class="table-responsive">
                <table class="table table-dark table-hover align-middle">
                    <thead>
                        <tr>
                            <th>Property</th>
                            <th>Contact Date</th>
                            <th>Message</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for c in contacts %}
                        <tr>
                            <td class="fw-600 text-white">{{ c.listing.title }}</td>
                            <td class="text-muted small">{{ c.contact_date|date:"d M Y" }}</td>
                            <td class="text-muted small">{{ c.message|truncatechars:60 }}</td>
                            <td><a href="/listings/{{ c.listing.pk }}/" class="btn btn-outline-warning btn-sm">View</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-envelope fa-3x mb-3 text-muted"></i>
                <h5 class="text-white">No inquiries yet</h5>
                <p class="text-muted">Browse listings and contact realtors to get started.</p>
                <a href="/listings/" class="btn btn-warning btn-sm fw-700">Browse Listings</a>
            </div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}