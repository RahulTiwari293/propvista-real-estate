{% extends 'base.html' %}
{% block title %}Listings | PropVista{% endblock %}
{% block content %}
<div class="page-header">
    <div class="container">
        <h2 class="fw-700 text-white">All <span class="text-warning">Listings</span></h2>
        <!-- Sale / Rent filter tabs -->
        <div class="d-flex gap-2 mt-3 flex-wrap">
            <a href="/listings/" class="filter-pill {% if current_type == 'all' %}active{% endif %}">All</a>
            <a href="/listings/?type=sale" class="filter-pill sale {% if current_type == 'sale' %}active{% endif %}">
                <i class="fas fa-home me-1"></i>For Sale
            </a>
            <a href="/listings/?type=rent" class="filter-pill rent {% if current_type == 'rent' %}active{% endif %}">
                <i class="fas fa-key me-1"></i>For Rent
            </a>
        </div>
    </div>
</div>

<div class="container py-5">
    <div class="row g-4">
        {% for l in listings %}
        <div class="col-lg-4 col-md-6">
            <div class="prop-card h-100">
                <div class="prop-img-wrap">
                    {% if l.photo_main %}
                    <img src="{{ l.photo_main.url }}" class="prop-img" alt="{{ l.title }}" />
                    {% else %}
                    <div class="prop-img-ph"><i class="fas fa-home fa-2x opacity-25"></i></div>
                    {% endif %}
                    <span class="prop-badge {% if l.listing_type == 'rent' %}badge-rent{% else %}badge-sale{% endif %}">
                        {% if l.listing_type == 'rent' %}<i class="fas fa-key me-1"></i>For Rent
                        {% else %}<i class="fas fa-home me-1"></i>For Sale{% endif %}
                    </span>
                </div>
                <div class="prop-body">
                    <p class="prop-price mb-1">
                        {{ l.price_inr }}{% if l.listing_type == 'rent' %}<span class="small text-muted">/mo</span>{%
                        endif %}
                    </p>
                    <h6 class="fw-700 mb-1">
                        <a href="{% url 'listing' l.pk %}" class="text-white text-decoration-none">{{ l.title }}</a>
                    </h6>
                    <p class="text-muted small mb-2">
                        <i class="fas fa-map-marker-alt me-1 text-warning"></i>{{ l.city }}, {{ l.state }}
                    </p>
                    <div class="prop-feats mb-2">
                        <span><i class="fas fa-bed"></i> {{ l.bedrooms }}</span>
                        <span><i class="fas fa-bath"></i> {{ l.bathrooms }}</span>
                        <span><i class="fas fa-expand-arrows-alt"></i> {{ l.sqft }} sqft</span>
                    </div>
                    {% if l.realtor %}<small class="text-muted">Listed by <strong class="text-white">{{ l.realtor.name
                            }}</strong></small>{% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="empty-state">
                <i class="fas fa-search fa-3x mb-3 text-muted"></i>
                <h5 class="text-white">No listings found</h5>
                <p class="text-muted">Try a different filter or <a href="/post-listing/" class="text-warning">post a
                        property</a>.</p>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if listings.has_other_pages %}
    <nav class="mt-5 d-flex justify-content-center">
        <ul class="pagination">
            {% if listings.has_previous %}
            <li class="page-item"><a class="page-link"
                    href="?page={{ listings.previous_page_number }}{% if current_type != 'all' %}&type={{ current_type }}{% endif %}">«</a>
            </li>
            {% endif %}
            {% for n in listings.paginator.page_range %}
            <li class="page-item {% if listings.number == n %}active{% endif %}">
                <a class="page-link"
                    href="?page={{ n }}{% if current_type != 'all' %}&type={{ current_type }}{% endif %}">{{ n }}</a>
            </li>
            {% endfor %}
            {% if listings.has_next %}
            <li class="page-item"><a class="page-link"
                    href="?page={{ listings.next_page_number }}{% if current_type != 'all' %}&type={{ current_type }}{% endif %}">»</a>
            </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}