{% extends 'base.html' %}
{% block title %}Search Properties | PropVista{% endblock %}
{% block content %}
<div class="page-header">
  <div class="container">
    <h2 class="fw-700 text-white">Search <span class="text-warning">Properties</span></h2>
  </div>
</div>

<div class="container py-5">
  <!-- Filter Form -->
  <div class="glass-card p-4 mb-5">
    <form method="GET" action="/search/">
      <div class="row g-3">
        <div class="col-md-3">
          <input type="text" name="keywords" class="form-control dark-input" placeholder="Keywords..."
            value="{{ values.keywords }}">
        </div>
        <div class="col-md-2">
          <input type="text" name="city" class="form-control dark-input" placeholder="City" value="{{ values.city }}">
        </div>
        <div class="col-md-2">
          <select name="state" class="form-select dark-input">
            <option value="">Any State</option>
            {% for s in "Maharashtra,Karnataka,Delhi,Tamil Nadu,Gujarat,Telangana,Kerala,Rajasthan,West Bengal,Uttar
            Pradesh,Punjab,Haryana"|split:"," %}
            <option {% if values.state==s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <select name="listing_type" class="form-select dark-input">
            <option value="">Sale & Rent</option>
            <option value="sale" {% if values.listing_type=='sale' %}selected{% endif %}>For Sale</option>
            <option value="rent" {% if values.listing_type=='rent' %}selected{% endif %}>For Rent</option>
          </select>
        </div>
        <div class="col-md-1">
          <select name="bedrooms" class="form-select dark-input">
            <option value="">Beds</option>
            {% for n in "1234567" %}
            <option value="{{ n }}" {% if values.bedrooms==n %}selected{% endif %}>{{ n }}+</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-1">
          <select name="price" class="form-select dark-input">
            <option value="">Max ₹</option>
            <option value="2000000" {% if values.price=='2000000' %}selected{% endif %}>₹20L</option>
            <option value="5000000" {% if values.price=='5000000' %}selected{% endif %}>₹50L</option>
            <option value="10000000" {% if values.price=='10000000' %}selected{% endif %}>₹1Cr</option>
            <option value="20000000" {% if values.price=='20000000' %}selected{% endif %}>₹2Cr</option>
            <option value="50000000" {% if values.price=='50000000' %}selected{% endif %}>₹5Cr</option>
          </select>
        </div>
        <div class="col-md-1">
          <button class="btn btn-warning w-100 fw-600"><i class="fas fa-search"></i></button>
        </div>
      </div>
    </form>
  </div>

  <!-- Results -->
  <h5 class="text-white mb-4">
    <span class="text-warning">{{ listings|length }}</span> result{{ listings|length|pluralize }} found
  </h5>

  <div class="row g-4">
    {% for l in listings %}
    <div class="col-lg-4 col-md-6">
      <div class="prop-card h-100">
        <div class="prop-img-wrap">
          {% if l.photo_main %}
          <img src="{{ l.photo_main.url }}" class="prop-img" alt="{{ l.title }}" />
          {% else %}
          <div class="prop-img-ph"><i class="fas fa-home fa-2x opacity-25"></i></div>
          {% endif %}
          <span class="prop-badge {% if l.listing_type == 'rent' %}badge-rent{% else %}badge-sale{% endif %}">
            {% if l.listing_type == 'rent' %}<i class="fas fa-key me-1"></i>For Rent
            {% else %}<i class="fas fa-home me-1"></i>For Sale{% endif %}
          </span>
        </div>
        <div class="prop-body">
          <p class="prop-price mb-1">
            {{ l.price_inr }}{% if l.listing_type == 'rent' %}<span class="small text-muted">/mo</span>{% endif %}
          </p>
          <h6 class="fw-700 mb-1">
            <a href="/listings/{{ l.pk }}/" class="text-white text-decoration-none">{{ l.title }}</a>
          </h6>
          <p class="text-muted small mb-2">
            <i class="fas fa-map-marker-alt me-1 text-warning"></i>{{ l.city }}, {{ l.state }}
          </p>
          <div class="prop-feats">
            <span><i class="fas fa-bed"></i> {{ l.bedrooms }}</span>
            <span><i class="fas fa-bath"></i> {{ l.bathrooms }}</span>
            <span><i class="fas fa-expand-arrows-alt"></i> {{ l.sqft }} sqft</span>
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12">
      <div class="empty-state">
        <i class="fas fa-search fa-3x mb-3 text-muted"></i>
        <h5 class="text-white">No results found</h5>
        <p class="text-muted">Try adjusting your filters or <a href="/post-listing/" class="text-warning">post a
            property</a>.</p>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}